###############################################################################
# OpenVAS Vulnerability Test
# $Id: gb_adminer_CVE-2018-7667_lin.nasl 13169 2019-01-20 13:26:42Z cfischer $
#
# Adminer <= 4.3.1 SSRF Vulnerability (Linux)
#
# Authors:
# Christian Fischer <christian.fischer@greenbone.net>
#
# Copyright:
# Copyright (C) 2019 Greenbone Networks GmbH
#
# This program is free software; you can redistribute it and/or modify
# it under the terms of the GNU General Public License as published by
# the Free Software Foundation; either version 2 of the License, or
# (at your option) any later version.
#
# This program is distributed in the hope that it will be useful,
# but WITHOUT ANY WARRANTY; without even the implied warranty of
# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
# GNU General Public License for more details.
#
# You should have received a copy of the GNU General Public License
# along with this program; if not, write to the Free Software
# Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
###############################################################################

CPE = "cpe:/a:adminer:adminer";

if(description)
{
  script_oid("1.3.6.1.4.1.25623.1.0.108532");
  script_version("$Revision: 13169 $");
  script_tag(name:"last_modification", value:"$Date: 2019-01-20 14:26:42 +0100 (Sun, 20 Jan 2019) $");
  script_tag(name:"creation_date", value:"2019-01-20 14:05:39 +0100 (Sun, 20 Jan 2019)");
  script_tag(name:"cvss_base", value:"7.5");
  script_tag(name:"cvss_base_vector", value:"AV:N/AC:L/Au:N/C:P/I:P/A:P");
  script_cve_id("CVE-2018-7667");
  script_name("Adminer <= 4.3.1 SSRF Vulnerability (Linux)");
  script_category(ACT_GATHER_INFO);
  script_copyright("Copyright (C) 2019 Greenbone Networks GmbH");
  script_family("Web application abuses");
  script_dependencies("gb_adminer_detect.nasl", "os_detection.nasl");
  script_mandatory_keys("adminer/detected", "Host/runs_unixoide");

  script_xref(name:"URL", value:"https://github.com/vrana/adminer/releases/tag/v4.4.0");
  script_xref(name:"URL", value:"http://hyp3rlinx.altervista.org/advisories/ADMINER-UNAUTHENTICATED-SERVER-SIDE-REQUEST-FORGERY.txt");
  script_xref(name:"URL", value:"https://seclists.org/fulldisclosure/2018/Jan/64");
  script_xref(name:"URL", value:"https://www.exploit-db.com/exploits/43593");

  script_tag(name:"summary", value:"Adminer is prone to a Server-Side Request Forgery vulnerability.");

  script_tag(name:"vuldetect", value:"Checks if a vulnerable version is present on the target host.");

  script_tag(name:"insight", value:"Adminer allows unauthenticated connections to be initiated to arbitrary systems/ports.");

  script_tag(name:"impact", value:"This vulnerability can be used to potentially bypass firewalls to
  identify internal hosts and perform port scanning of other servers for reconnaissance purposes.");

  script_tag(name:"affected", value:"Adminer version 4.3.1 and prior.");

  script_tag(name:"solution", value:"Update to version 4.4.0 or later which disables the possibility to connect
  to privileged ports. Please note that this is only partially mitigating this vulnerability and port scanning
  is still possible against ports in the range of > 1024.");

  script_tag(name:"qod_type", value:"remote_banner_unreliable");
  script_tag(name:"solution_type", value:"Mitigation");

  exit(0);
}

include("host_details.inc");
include("version_func.inc");

if( ! port = get_app_port( cpe:CPE ) )
  exit( 0 );

if( ! info = get_app_version_and_location( cpe:CPE, port:port, exit_no_version:TRUE ) )
  exit( 0 );

vers = info["version"];
if( version_is_less( version:vers, test_version:"4.4.0" ) ) {
  report = report_fixed_ver( installed_version:vers, fixed_version:"4.4.0", install_path:info["location"] );
  security_message( port:port, data:report );
  exit( 0 );
}

exit( 99 );